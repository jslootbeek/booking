"use strict";var bookingApp=angular.module("bookingApp",["ngAnimate","firebase","firebase.ref","ngRoute","checklist-model"]);bookingApp.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/company/:companyName?",{templateUrl:"views/company.html",controller:"CompanyCtrl"}).when("/appointment/:companyName?",{templateUrl:"views/appointment.html",controller:"AppointmentCtrl",controllerAs:"appointment"}).when("/checkin/:companyName?",{templateUrl:"views/checkin.html",controller:"CheckinCtrl"})}]),angular.module("bookingApp").controller("MainCtrl",function(){}),angular.module("firebase.config",[]).constant("FBURL","https://blazing-heat-2476.firebaseio.com/").constant("SIMPLE_LOGIN_PROVIDERS",["password"]).constant("loginRedirectPath","/login"),angular.module("firebase.ref",["firebase","firebase.config"]).factory("Ref",["$window","FBURL",function(a,b){return new a.Firebase(b)}]),angular.module("bookingApp").controller("ChatCtrl",["$scope","Ref","$firebaseArray","$timeout",function(a,b,c,d){function e(b){a.err=b,d(function(){a.err=null},5e3)}a.messages=c(b.child("messages").limitToLast(10)),a.messages.$loaded()["catch"](e),a.addMessage=function(b){b&&a.messages.$add({text:b})["catch"](e)}}]),angular.module("bookingApp").filter("reverse",function(){return function(a){return angular.isArray(a)?a.slice().reverse():[]}}),function(){angular.module("firebase.auth",["firebase","firebase.ref"]).factory("Auth",["$firebaseAuth","Ref",function(a,b){return a(b)}])}(),angular.module("bookingApp").controller("LoginCtrl",["$scope","Auth","$location","$q","Ref","$timeout",function(a,b,c,d,e,f){function g(a){return h(a.substr(0,a.indexOf("@"))||"")}function h(a){a+="";var b=a.charAt(0).toUpperCase();return b+a.substr(1)}function i(){c.path("/account")}function j(b){a.err=b}a.passwordLogin=function(c,d){a.err=null,b.$authWithPassword({email:c,password:d},{rememberMe:!0}).then(i,j)},a.createAccount=function(c,h,k){function l(a){var b=e.child("users",a.uid),h=d.defer();return b.set({email:c,name:g(c)},function(a){f(function(){a?h.reject(a):h.resolve(b)})}),h.promise}a.err=null,h?h!==k?a.err="Passwords do not match":b.$createUser({email:c,password:h}).then(function(){return b.$authWithPassword({email:c,password:h},{rememberMe:!0})}).then(l).then(i,j):a.err="Please enter a password"}}]),angular.module("bookingApp").controller("AccountCtrl",["$scope","user","Auth","Ref","$firebaseObject","$timeout",function(a,b,c,d,e,f){function g(a){i(a,"danger")}function h(a){i(a,"success")}function i(b,c){var d={text:b+"",type:c};a.messages.unshift(d),f(function(){a.messages.splice(a.messages.indexOf(d),1)},1e4)}a.user=b,a.logout=function(){c.$unauth()},a.messages=[];var j=e(d.child("users/"+b.uid));j.$bindTo(a,"profile"),a.changePassword=function(b,d,e){a.err=null,b&&d?d!==e?g("Passwords do not match"):c.$changePassword({email:j.email,oldPassword:b,newPassword:d}).then(function(){h("Password changed")},g):g("Please enter all fields")},a.changeEmail=function(b,d){a.err=null,c.$changeEmail({password:b,newEmail:d,oldEmail:j.email}).then(function(){j.email=d,j.$save(),h("Email changed")})["catch"](g)}}]),angular.module("bookingApp").directive("ngShowAuth",["Auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuth(e),e()}}}]),angular.module("bookingApp").directive("ngHideAuth",["Auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuth(e),e()}}}]),angular.module("bookingApp").controller("CompanyCtrl",["$scope","$routeParams","Ref","$firebaseArray","$timeout","states",function(a,b,c,d,e,f){function g(b){a.err=b,e(function(){a.err=null},5e3)}a.selectedCompany=null,a.companyDisabled=!1,a.newCompany={acceptedInsurances:[]},a.states=f.all(),a.companies=d(c.child("clients")),a.insurances=d(c.child("insurances")),a.companies.$loaded().then(function(c){void 0!==b.companyName&&c.forEach(function(c,d,e){c.$id===b.companyName&&(a.getDates(c),a.companyDisabled=!0)})})["catch"](g);var h;a.selectedSlot=null,a.isActiveSlot=function(a){return h===a},a.selectSlot=function(b,c){h=b,a.selectedSlot=c},a.insurances.$loaded().then(function(){a.tmpInsurance=a.insurances[0]})["catch"](g),a.addCompany=function(b){b&&a.companies.$add(b).then(function(b){a.msg="Company Added"})},a.getDates=function(b){a.dates=d(c.child("dates").orderByChild("company").equalTo(b.$id)),a.selectedCompany=b,a.dates.$loaded().then(function(){a.selectedDate=a.dates[0]})["catch"](g)},a.clearSlots=function(){h=null,a.selectedSlot=null},a.cancel=function(b,c){c.appointments.splice(b,1),c.count=c.appointments.length,a.dates.$save(a.selectedDate).then(function(a){})}}]),angular.module("bookingApp").controller("DateCtrl",["$scope","Ref","$firebaseArray","$timeout",function(a,b,c,d){function e(b){a.err=b,d(function(){a.err=null},5e3)}a.breakStart=new Date(1970,0,1,12,0,0),a.breakEnd=new Date(1970,0,1,13,0,0),a.newDate={startTime:new Date(1970,0,1,8,0,0),endTime:new Date(1970,0,1,17,0,0)},a.dates=c(b.child("dates")),a.trucks=c(b.child("trucks")),a.dates.$loaded()["catch"](e),a.trucks.$loaded().then(function(){a.newDate.truck=a.trucks[0].$id})["catch"](e),a.addDate=function(b){if(b){b.company=a.company.$id,b.slots={},b.startDate=new Date(b.date.getFullYear(),b.date.getMonth(),b.date.getDate(),b.startTime.getHours(),b.startTime.getMinutes()).getTime(),b.endDate=new Date(b.date.getFullYear(),b.date.getMonth(),b.date.getDate(),b.endTime.getHours(),b.endTime.getMinutes()).getTime();for(var c=new Date(b.date.getFullYear(),b.date.getMonth(),b.date.getDate(),a.breakStart.getHours(),a.breakStart.getMinutes()).getTime(),d=new Date(b.date.getFullYear(),b.date.getMonth(),b.date.getDate(),a.breakEnd.getHours(),a.breakEnd.getMinutes()).getTime(),f=6e5,g=0,h=b.startDate;h<b.endDate;){var i=h+f;(c>h||h>=d)&&++g%6!==0&&(b.slots[h+"-"+i]={count:0,appointments:[]}),h=i}console.log(b),b.date=b.date.getTime(),a.dates.$add(b).then(function(b){a.msg="Date added."})["catch"](e)}}}]),angular.module("bookingApp").controller("AppointmentCtrl",["$scope","$routeParams","Ref","$firebaseObject","$firebaseArray","$timeout","states",function(a,b,c,d,e,f,g){function h(b){a.err=b,f(function(){a.err=null},5e3)}a.newAppointment=[],a.states=g.all(),a.reasons=e(c.child("reasons")),a.reasons.$loaded()["catch"](h),a.companies=e(c.child("clients")),a.companies.$loaded().then(function(c){void 0!==b.companyName&&c.forEach(function(c,d,e){c.$id===b.companyName&&(a.newAppointment.company=c,a.getDates(),a.companyDisabled=!0)})})["catch"](h),a.patientData={reasons:[]},a.getDates=function(){a.dates=e(c.child("dates").orderByChild("company").equalTo(a.newAppointment.company.$id)),a.dates.$loaded().then(function(){a.newAppointment.date=a.dates[0]})["catch"](h)},a.addAppointment=function(b){b&&(b.date.slots[b.selectedSlot].appointments||(b.date.slots[b.selectedSlot].appointments=[]),b.date.slots[b.selectedSlot].appointments.push(a.patientData),b.date.slots[b.selectedSlot].count=b.date.slots[b.selectedSlot].appointments.length,a.dates.$save(b.date).then(function(b){a.msg="Your appointment was made."}))}}]),angular.module("bookingApp").service("states",function(){var a=[{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"American Samoa",abbreviation:"AS"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"District Of Columbia",abbreviation:"DC"},{name:"Federated States Of Micronesia",abbreviation:"FM"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Guam",abbreviation:"GU"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Marshall Islands",abbreviation:"MH"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Northern Mariana Islands",abbreviation:"MP"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Oregon",abbreviation:"OR"},{name:"Palau",abbreviation:"PW"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Puerto Rico",abbreviation:"PR"},{name:"Rhode Island",abbreviation:"RI"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virgin Islands",abbreviation:"VI"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"}];return{all:function(){return a}}}),angular.module("bookingApp").filter("split",function(){return function(a){var b=a.split("-"),c=new Date(parseInt(b[0])),d=new Date(parseInt(b[1])),e=c.getHours(),f=12>e?"AM":"PM";e>12&&(e-=12);var g=e+":"+("00"+c.getMinutes()).slice(-2)+" "+f,h=d.getHours(),f=12>h?"AM":"PM";h>12&&(h-=12);var i=h+":"+("00"+d.getMinutes()).slice(-2)+" "+f;return g+" - "+i}}),angular.module("bookingApp").directive("addDateForm",function(){return{templateUrl:"views/date.html",restrict:"EA",scope:{company:"="},controller:"DateCtrl"}}),angular.module("bookingApp").controller("CheckinCtrl",["$scope","Ref","$routeParams","$firebaseArray","$filter","$timeout",function(a,b,c,d,e,f){function g(b){a.err=b,f(function(){a.err=null},5e3)}a.companies=d(b.child("clients")),a.companies.$loaded().then(function(b){void 0!==c.companyName&&b.forEach(function(b,d,e){b.$id===c.companyName&&(a.getDate(b),a.companyDisabled=!0)})})["catch"](g),a.getDate=function(c){var e=new Date;a.dates=d(b.child("dates").orderByChild("company").equalTo(c.$id)),a.selectedCompany=c,a.dates.$loaded(function(b){b.forEach(function(b,c,d){b.date===new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()&&(a.date=b)})})["catch"](g)},a.getSlot=function(){a.slot=null,a.slotTime=null;for(var b in a.date.slots)if(b){var c=a.date.slots[b];if(c.appointments&&0!==c.appointments.length&&c.appointments[0].email===a.email)return a.appointment=c.appointments[0],void(a.slotTime=b)}},a.checkin=function(){a.appointment.checkedInTime=(new Date).getTime(),a.dates.$save(a.date),a.email=null}}]);